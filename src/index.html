<!DOCTYPE html>
<html>
<head>
  <title> self.name </title>
  <link rel="stylesheet" href="/style.css">
  <script type="text/javascript">[% memorable_wordlist::JAVASCRIPT as UTF8 %]</script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.5/ace.js" type="text/javascript" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.5/mode-latex.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: { equationNumbers: { autoNumber: "AMS" } },
      "HTML-CSS": { availableFonts: ["TeX"] }
    });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
      TeX: {
        equationNumbers: { autoNumber: "AMS" }
      };
    });
  </script>
  <style type="text/css" media="screen">
    #editor {
        width: 49%;
        min-height: 12em;
    }
    aside {
        float: right;
        width: 50%;
    }
    .preview {
        background-color: #ffffff;
        margin-left: 50%;
        width: 49%;
        position: absolute;
        color: #7FB3D5;
    }
    div.center {
        text-align: center;
        margin-left: auto;
        margin-right: auto;
    }
    .solution {
        margin-left: 1em;
        color: #000000;
    }
    .error {
        background-color: #ff6666;
    }
    .warning {
        background-color: #ffff66;
    }
</style>
</head>
<body>
  <main>
    <header>
      <h1> Thing Lists </h1>
    </header>
    <p>
      This website allows you to create lists of things that you want to
      occasionally do.  I use this for things like books to reread,
      recipes to make for dinner, or songs to sing to my daughter.  In
      each case, I'd like to have variety, and not do the same thing
      over and over.  But in each case there are also some favorites
      that I want to do more frequently.  Thing Lists attempts to
      determine how frequently you'd like to do each thing based on
      your usage patterns, with a bias towards variety, to help keep
      you from getting in a rut.
    </p>
    <p>
      If you want help with using these lists (or if you use this and
      like it), please feel free to
      <a href="mailto:daveroundy@gmail.com">email me.</a>
    </p>
    <form id="pass-form"
          target="hidden-form"
          onsubmit="var name_element = document.getElementById('the-name');
; window.location.href = passphrase_camel_case(44)+'/'+name_element.value; return false;">
      <label>Create a new list</label>
      <input type="text" name="name" id="the-name">
    </form>
    <iframe style="display:none" name="hidden-form"></iframe>
    <div class="preview", id="preview">
    </div>
    <div id="buffer", class="preview"></div>
    <div id="editor">\paragraph{Test}
This is \emph{nice} stuff.
\begin{align}
f(x) &= x^2 + e^x \\
g(x) &= \frac1{1+x^2}
      \end{align}
      \begin{solution}
      This is the solution, see \eqref{this_eq}.
      \begin{align}
        x^2 \label{this_eq}
      \end{align}
      \end{solution}
    </div>
  </main>
  <!-- Note the usage of `type=module` here as this is an ES6 module -->
  <script type="module">
// Use ES module import syntax to import functionality from the module
// that we have compiled.
//
// Note that the `default` import is an initialization function which
// will "boot" the module and make it ready to use. Currently browsers
// don't support natively imported WebAssembly as an ES module, but
// eventually the manual initialization won't be required!
import init, { html_with_solution, html_omit_solution } from '/latex_snippet.js';

async function run() {
    // First up we need to actually load the wasm file, so we use the
    // default export to inform it where the wasm file is located on the
    // server, and then we wait on the returned promise to wait for the
    // wasm to be loaded.
    // It may look like this: `await init('./pkg/without_a_bundler_bg.wasm');`,
    // but there is also a handy default inside `init` function, which uses
    // `import.meta` to locate the wasm file relatively to js file
    //
    // Note that instead of a string here you can also pass in an instance
    // of `WebAssembly.Module` which allows you to compile your own module.
    // Also note that the promise, when resolved, yields the wasm module's
    // exports which is the same as importing the `*_bg` module in other
    // modes
    await init();

    // And afterwards we can use all the functionality defined in wasm.
    var Preview = {
        delay: 150,        // delay after keystroke before updating

        preview: null,     // filled in by Init below
        buffer: null,      // filled in by Init below

        timeout: null,     // store setTimout id
        mjRunning: false,  // true when MathJax is processing
        mjPending: false,  // true when a typeset has been queued
        oldText: null,     // used to check if an update is needed
        math_html: null,   // used to store the new html we want

        //
        //  Get the preview and buffer DIV's
        //
        Init: function () {
            this.preview = document.getElementById("preview");
            this.buffer = document.getElementById("buffer");
        },

        //
        //  Switch the buffer and preview, and display the right one.
        //  (We use visibility:hidden rather than display:none since
        //  the results of running MathJax are more accurate that way.)
        //
        SwapBuffers: function () {
            var buffer = this.preview, preview = this.buffer;
            this.buffer = buffer; this.preview = preview;
            buffer.style.visibility = "hidden"; // buffer.style.position = "absolute";
            // preview.style.position = "";
            preview.style.visibility = "";
        },

        //
        //  Creates the preview and runs MathJax on it.
        //  If MathJax is already trying to render the code, return
        //  If the text hasn't changed, return
        //  Otherwise, indicate that MathJax is running, and start the
        //    typesetting.  After it is done, call PreviewDone.
        //
        CreatePreview: function () {
            Preview.timeout = null;
            if (this.mjPending) return;
            var text = this.math_html;
            if (text === this.oldtext) return;
            if (this.mjRunning) {
                this.mjPending = true;
                MathJax.Hub.Queue(["CreatePreview",this]);
            } else {
                this.buffer.innerHTML = this.oldtext = text;
                this.mjRunning = true;
                MathJax.Hub.Queue(
                    function () {
                        if (MathJax.InputJax.TeX.resetEquationNumbers) {
                            MathJax.InputJax.TeX.resetEquationNumbers();
                        }
                    },
                    // ["resetEquationNumbers",MathJax.InputJax.TeX],
                    ["Typeset",MathJax.Hub,this.buffer],
	                  ["PreviewDone",this]
                );
            }
        },

        //
        //  Indicate that MathJax is no longer running,
        //  and swap the buffers to show the results.
        //
        PreviewDone: function () {
            this.mjRunning = this.mjPending = false;
            this.SwapBuffers();
        }

    };

    //
    //  Cache a callback to the CreatePreview action
    //
    Preview.Init();
    Preview.callback = MathJax.Callback(["CreatePreview",Preview]);
    Preview.callback.autoReset = true;  // make sure it can run more than once
    var my_timeout = null;
    function update_preview() {
        Preview.math_html = html_with_solution(editor.getValue());
        Preview.CreatePreview();
    }
    var preview = document.getElementById('preview');
    var editor = ace.edit("editor", {
        mode: "ace/mode/latex",
        // autoScrollEditorIntoView: true,
        maxLines: 4000,
        minLines: 15,
    });
    // editor.session.setMode("ace/mode/latex");
    editor.renderer.setShowGutter(false);
    update_preview(editor.getValue());
    editor.session.on('change', function(delta) {
        // preview.innerHTML = editor.getValue();
        if (my_timeout) {
            clearTimeout(my_timeout);
        }
        my_timeout = setTimeout(update_preview, 150);
    });
}

run();
  </script>
</body>
</html>


