<!DOCTYPE html>
<html>
<head>
  <title> self.name </title>
  <link rel="stylesheet" href="/style.css">
  <script type="text/javascript">[% memorable_wordlist::JAVASCRIPT as UTF8 %]</script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.5/ace.js" type="text/javascript" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.5/mode-latex.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: { equationNumbers: { autoNumber: "AMS" } },
      "HTML-CSS": { availableFonts: ["TeX"] }
    });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
      TeX: {
        equationNumbers: { autoNumber: "AMS" }
      };
    });
  </script>
  <style type="text/css" media="screen">
    .latexeditor, .ace_editor {
        width: 49%;
        min-height: 12em;
    }
    aside {
        float: right;
        width: 50%;
    }
    .preview {
        background-color: #ffffff;
        margin-left: 50%;
        width: 49%;
        position: absolute;
        color: #7FB3D5;
    }
    div.center {
        text-align: center;
        margin-left: auto;
        margin-right: auto;
    }
    .solution {
        margin-left: 1em;
        color: #000000;
    }
    .error {
        background-color: #ff6666;
    }
    .warning {
        background-color: #ffff66;
    }
</style>
</head>
<body>
  <main>
    <header>
      <h1> Thing Lists </h1>
    </header>
    <p>
      This website allows you to create lists of things that you want to
      occasionally do.  I use this for things like books to reread,
      recipes to make for dinner, or songs to sing to my daughter.  In
      each case, I'd like to have variety, and not do the same thing
      over and over.  But in each case there are also some favorites
      that I want to do more frequently.  Thing Lists attempts to
      determine how frequently you'd like to do each thing based on
      your usage patterns, with a bias towards variety, to help keep
      you from getting in a rut.
    </p>
    <p>
      If you want help with using these lists (or if you use this and
      like it), please feel free to
      <a href="mailto:daveroundy@gmail.com">email me.</a>
    </p>
    <form id="pass-form"
          target="hidden-form"
          onsubmit="var name_element = document.getElementById('the-name');
; window.location.href = passphrase_camel_case(44)+'/'+name_element.value; return false;">
      <label>Create a new list</label>
      <input type="text" name="name" id="the-name">
    </form>
    <iframe style="display:none" name="hidden-form"></iframe>
    <div id="editor" class="latexeditor">\paragraph{Test}
This is \emph{nice} stuff.
\begin{align}
f(x) &= x^2 + e^x \\
g(x) &= \frac1{1+x^2}
      \end{align}
      \begin{solution}
      This is the solution, see \eqref{this_eq}.
      \begin{align}
        x^2 \label{this_eq}
      \end{align}
      \end{solution}
    </div>
    <textarea class="latexeditor">\paragraph{Test}
This is \emph{nice} stuff.
\begin{align}
f(x) &= x^2 + e^x \\
g(x) &= \frac1{1+x^2}
      \end{align}
      \begin{solution}
      This is the solution, see \eqref{nother_eq}.
      \begin{align}
        x^2 \label{nother_eq}
      \end{align}
      \end{solution}
    </textarea>
  </main>
  <!-- Note the usage of `type=module` here as this is an ES6 module -->
  <script type="module">
// Use ES module import syntax to import functionality from the module
// that we have compiled.
//
// Note that the `default` import is an initialization function which
// will "boot" the module and make it ready to use. Currently browsers
// don't support natively imported WebAssembly as an ES module, but
// eventually the manual initialization won't be required!
import init, { html_with_solution, html_omit_solution } from '/latex_snippet.js';

async function run() {
    // First up we need to actually load the wasm file, so we use the
    // default export to inform it where the wasm file is located on the
    // server, and then we wait on the returned promise to wait for the
    // wasm to be loaded.
    // It may look like this: `await init('./pkg/without_a_bundler_bg.wasm');`,
    // but there is also a handy default inside `init` function, which uses
    // `import.meta` to locate the wasm file relatively to js file
    //
    // Note that instead of a string here you can also pass in an instance
    // of `WebAssembly.Module` which allows you to compile your own module.
    // Also note that the promise, when resolved, yields the wasm module's
    // exports which is the same as importing the `*_bg` module in other
    // modes
    await init();

    var latexEditors = document.querySelectorAll(".latexeditor");

    const delay = 150;

    latexEditors.forEach(function(editElement) {
        //
        //  Get the preview and buffer DIV's
        //
        var preview = document.createElement( 'div' );
        preview.visibility = "hidden";
        preview.classList.add('preview');
        var buffer = document.createElement( 'div' );
        buffer.visibility = "hidden";
        buffer.classList.add('preview');
        editElement.parentNode.insertBefore( preview, editElement );
        editElement.parentNode.insertBefore( buffer, editElement );

        var timeout = null;
        var mjRunning = false;
        var oldtext = "oops";

        //
        //  Creates the preview and runs MathJax on it.
        //  If MathJax is already trying to render the code, return
        //  If the text hasn't changed, return
        //  Otherwise, indicate that MathJax is running, and start the
        //    typesetting.  After it is done, call PreviewDone.
        //
        var update_preview = function () {
            if (mjRunning) {
                timeout = setTimeout(update_preview, delay);
                return;
            }
            timeout = null;
            var text = editor.getValue();
            if (text === oldtext) return;
            oldtext = text;
            buffer.innerHTML = html_with_solution(text);
            mjRunning = true;
            MathJax.Hub.Queue(
                function () {
                    if (MathJax.InputJax.TeX.resetEquationNumbers) {
                        MathJax.InputJax.TeX.resetEquationNumbers();
                    }
                },
                // ["resetEquationNumbers",MathJax.InputJax.TeX],
                ["Typeset",MathJax.Hub,buffer],
                function () {
                    //  Indicate that MathJax is no longer running,
                    //  and swap the buffers to show the results.
                    mjRunning = false;
                    //  Switch the buffer and preview, and display
                    //  the right one.  (We use visibility:hidden
                    //  rather than display:none since the results
                    //  of running MathJax are more accurate that
                    //  way.)
                    var b = preview, p = buffer;
                    buffer = b; preview = p;
                    buffer.style.visibility = "hidden";
                    preview.style.visibility = "";
                }
            );
        };

        var editor = ace.edit(editElement, {
            mode: "ace/mode/latex",
            wrap: true,   // wrap text to view
            showGutter: false,
            maxLines: 4000,
            minLines: 15,
        });
        //  Cache a callback to the update_preview action
        var callback = MathJax.Callback(update_preview);
        callback.autoReset = true;  // make sure it can run more than once
        update_preview();
        editor.session.on('change', function(delta) {
            if (timeout) {
                clearTimeout(timeout);
            }
            timeout = setTimeout(update_preview, delay);
        });
    });
}

run();
  </script>
</body>
</html>


